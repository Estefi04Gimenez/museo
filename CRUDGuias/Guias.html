<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../bootstrap-5.0.2/dist/css/bootstrap.css">
    <script src="../bootstrap-5.0.2/dist/js/bootstrap.js"></script>
    <script src="../bootstrap-5.0.2/jquery-3.6.0.js"></script>
    <title>Document</title>
</head>
<body>
    <body>
        <div class="container">
            <div class="row">
                <div class="col">
                      <h1>Consulta a base de datos</h1>      
                </div>
            </div>
            <div class="row justify-content-between">
                <div class="d-grid col-2">
                    <input type="date" class="form-control text-center mb-2 " name="fechaActual" id="fechaActual" readonly> 
                </div>
                <div class="d-grid col-2">
                    <button id="botonModal" type="button" class="btn text-center mb-2 btn-primary" data-bs-toggle="modal" data-bs-target="#myModalGuias">+</button>    
                </div>
            </div>
            <div class="row ">
                <div class="d-grid  col-2">
                    <button id="cargarTablaGuias" type="button" class="btn text-center mb-2 btn-primary">Cargar Tabla</button>
                </div>          
                <div class="d-grid  col-2">
                    <button id="acualizarEstados" type="button" class="btn text-center mb-2 btn-secondary">Actualizar Tabla</button>
                </div>  
            </div>
            <!-- The Modal --> 
            <div class="modal fade" data-bs-backdrop="static" id="myModalGuias">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                    
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Añadir datos</h4>
                            <button id="closeModalGuias(1)" type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                    
                        <!-- Modal body -->
                        <div class="container"> 
                            <form id="formAddGuias">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Cupo maximo</label>
                                            <input name="cupoMaximo" type="text" id="cupoMaximo" min="0" max="11" placeholder="" class="form-control">        
                                        </div>
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Costo</label>
                                            <input name="costo" type="text" id="costo" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Fecha</label>
                                            <input name="fecha" type="date" id="fecha" min="0" max="11" placeholder="" class="form-control">        
                                        </div>
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">hora</label>
                                            <input name="hora" type="time" id="hora" min="0" max="11" placeholder="" class="form-control">        
                                        </div>
                                    </div>   
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Tipo de Guia</label>
                                            <input name="tipo" type="text" id="tipo" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">descripcion</label>
                                            <input name="descripcion" type="text" id="descripcion" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div> 
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Idioma</label>
                                            <input name="idioma" type="text" id="idioma" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Guia</label>
                                            <input name="guia" type="text" id="guia" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    
                                </div>
                            </form>    
                        </div>

                            <!-- Modal footer -->
                        <div class="modal-footer">
                            <button id="closeModal2Guias(1)" type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                            <button id="addDataGuias" type="button" class="btn btn-primary xd">enviar</button>
                        </div>        
                    </div>
                </div>      
            </div>   
            
            <div class="row">
                <div class="col">   
                    <table class="table table-bordered table-hover table-striped table-sm">
                        <thead>
                            <tr>
                                <th class='xd'>Acciones</th>
                                <th class='xd'>ID Guia</th>
                                <th class='xd'>Tipo</th>
                                <th class='xd'>Idioma</th>
                                <th class='xd'>Costo</th>
                                <th class='xd'>Descripción</th>
                                <th class='xd'>Guia</th>
                                <th class='xd'>Fecha</th>
                                <th class='xd'>Hora</th>
                                <th class='xd'>N° Personas Registrada</th>
                                <th class='xd'>Cupo Maximo</th>
                                <th class='xd'>Estado</th>
                            </tr>
                        </thead>
                        <tbody  id="tablaGuias">
                           
                        </tbody>
                    </table>    
                </div>
                <!--<div class="col-2">-->
                    <!-- The Modal -->
                    <div class="modal fade" data-bs-backdrop="static" id="modalUDGuias">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <form id="formUDGuias">
                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <div class="col-5">
                                            <h4 class="modal-title">Editar datos</h4>
                                        </div>
                                        <div class="col-2">
                                            <label>id</label>
                                            <input type="text" class="form-control" name="idUDGuias" id="idUDGuias" readonly>
                                        </div>
                                        <div class="col-5 text-end">  
                                            <button id="closeModalUDGuias" type="button" onclick="" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                    </div>
                            
                                    <!-- Modal body -->
                                    <div class="container"> 
                                        <div class="modal-body">
                                            <div class="col">                                        
                                                <label for="texto de ejemplo" class="form-label">Estado</label>
                                                <input name="estadoUDGuias" type="text" id="estadoUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">N° Personas Registradas</label>
                                                    <input name="cantidadRegistradaUDGuias" type="number" id="cantidadRegistradaUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Cupo maximo</label>
                                                    <input name="cupoMaximoUDGuias" type="text" id="cupoMaximoUDGuias" min="0" max="11" placeholder="" class="form-control">        
                                                </div>
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Costo</label>
                                                    <input name="costoUDGuias" type="text" id="costoUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Fecha</label>
                                                    <input name="fechaUDGuias" type="text" id="fechaUDGuias" min="0" max="11" placeholder="" class="form-control">        
                                                </div>
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Hora</label>
                                                    <input name="horaUDGuias" type="text" id="horaUDGuias" min="0" max="11" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Idioma</label>
                                                    <input name="descripcionUDGuias" type="text" id="descripcionUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Idioma</label>
                                                    <input name="idiomaUDGuias" type="text" id="idiomaUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Guia</label>
                                                    <input name="guiaUDGuias" type="text" id="guiaUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Tipo de Guia</label>
                                                    <input name="tipoUDGuias" type="text" id="tipoUDGuias" min="0" max="150" placeholder="" class="form-control">        
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </form>  
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button id="closeModalUDGuias2" type="button" class="btn btn-danger"  data-bs-dismiss="modal">Cancelar</button>
                                    <button id="editDataGuias" type="button" class="btn btn-primary xd" >enviar</button>
                                    <button id="deleteDataGuias" type="button" class="btn btn-danger xd" >eliminar</button>
                                </div>        
                            </div>
                        </div>  
                    </div>

                    <!--div class="col">   
                        <table class="table table-bordered table-hover table-striped table-sm">
                            <thead>
                                <tr>
                                    <th class='xd'>Acciones</th>
                                    <th class='xd'>ID Guia</th>
                                    <th class='xd'>Tipo</th>
                                    <th class='xd'>Idioma</th>
                                    <th class='xd'>Costo</th>
                                    <th class='xd'>Descripción</th>
                                    <th class='xd'>Guia</th>
                                    <th class='xd'>Fecha</th>
                                    <th class='xd'>Hora</th>
                                    <th class='xd'>N° Personas Registrada</th>
                                    <th class='xd'>Cupo Maximo</th>
                                    <th class='xd'>Estado</th>
                                </tr>
                            </thead>
                            <tbody  id="tablaGuiasYUsuarios">
                               
                            </tbody>
                        </table>    
                    </div-->
                <!--</div>-->
            </div>
        </div>
    </body>
    </html>
    
<script>

$(document).ready(function()
{
    function recuperarFecha()
    {

    //recupera la fecha
    const today = new Date();
    const yyyy = today.getFullYear();
    let mm = today.getMonth() + 1; // Months start at 0!
    let dd = today.getDate();

    if (dd < 10) dd = '0' + dd;
    if (mm < 10) mm = '0' + mm;

    const formattedToday = dd + '-' + mm + '-' + yyyy;
    var fecha = yyyy + '-' + mm + '-' + dd;//formato que se muestra en pantalla

    console.log(formattedToday)
    $("#fechaActual").val(fecha)
    }
    recuperarFecha();
    
    async function confirmAddGuias()
    {
    var datos = $('#formAddGuias').serializeArray();
        $.ajax({
            type:"POST",    
            url:"addGuias.php",
            data: datos,
            success:function(r){
                if(r == 1)
                {
                    alert("agregado con exito");
                    //$("#ordenarNomb").val(salaMuseo.value)
                    cargarTablaGuias();
                    $("#myModalGuias").modal('hide')
                }else
                {
                    alert("Fallo");
                }
            }
        })
     
    }
    $("#addDataGuias").on("click", function(){confirmAddGuias() }) 

    function actualizarFechas()
    {
        var fecha = $("#fechaActual").val();
        console.log(fecha)
        //console.log(editarDatos)
        //editarDatos.push({"name": 'funcion', "value": '1'})
        //console.log(editarDatos)
        
       $.ajax({
        url: "RenameGuias.php",
        type: "POST",
        data: {"funcion": 5, "fechaActual": fecha},
        success: function(r)
        {
            if (r == 1) 
                {

                //alert("Fechas Actualizadas")
                //$("#ordenarNomb").val(exposicionesUD.value)
                cargarTablaGuias()
                //$("#modalUD").modal('hide')

                }
            }
        })
    }
    
    $('#acualizarEstados').on('click', function(){
        actualizarFechas()
    })

    function confirmEditGuias()
    {
        var editarDatos = $("#formUDGuias").serializeArray();
        editarDatos.push({"name": 'funcion', "value": '1'})
        console.log(editarDatos)

        $.ajax({
        url: "RenameGuias.php",
        type: "POST",
        data: editarDatos,
        success: function(r)
        {
            if (r == 1) 
                {

                alert("datos modificados con exito")
                cargarTablaGuias()
                $("#modalUDGuias").modal('hide')

                }
            }
        })

    }

    function confirmDeleteGuias()
    {
        var eliminarDatos = $("#formUDGuias").serializeArray();
        //console.log("editarDatos: ", eliminarDatos)
        $.ajax({
        url: "DeleteGuias.php",
        type: "POST",
        data: eliminarDatos,
        success: function(r){
            if (r == 1) 
                {
                
                alert("datos Eliminados")
                cargarTablaGuias()
                $("#modalUDGuias").modal('hide')
                
                }
            }
        })
    }

    $("#editDataGuias").on("click", function(){confirmEditGuias() }) 
    $("#deleteDataGuias").on("click", function(){confirmDeleteGuias()}) 

    function cargarFormEditGuias(value)
    {
        $("#editDataGuias").show()
        $("#deleteDataGuias").hide()
        
        $("#idUDGuias").val(value.id_guia)
        $("#idUDGuias").attr('placeholder', value.id_guia) 
        
        $("#tipoUDGuias").val(value.tipo)
        $("#tipoUDGuias").attr('placeholder', value.tipo) 
        $("#tipoUDGuias").attr('readonly', false)
        
        $("#idiomaUDGuias").val(value.idioma)
        $("#idiomaUDGuias").attr('placeholder', value.idioma) 
        $("#idiomaUDGuias").attr('readonly', false)
        
        $("#costoUDGuias").val(value.costo)
        $("#costoUDGuias").attr('placeholder', value.costo) 
        $("#costoUDGuias").attr('readonly', false)

        $("#descripcionUDGuias").val(value.descripcion)
        $("#descripcionUDGuias").attr('placeholder', value.descripcion) 
        $("#descripcionUDGuias").attr('readonly', false)

        $("#fechaUDGuias").val(value.fecha)
        $("#fechaUDGuias").attr('placeholder', value.fecha) 
        $("#fechaUDGuias").attr('readonly', false)

        $("#horaUDGuias").val(value.hora)
        $("#horaUDGuias").attr('placeholder', value.hora) 
        $("#horaUDGuias").attr('readonly', false)
        
        $("#cantidadRegistradaUDGuias").val(value.cantidad_registrado)
        $("#cantidadRegistradaUDGuias").attr('placeholder', value.cantidad_registrado) 
        $("#cantidadRegistradaUDGuias").attr('readonly', false)
        
        $("#cupoMaximoUDGuias").val(value.cupo_max)
        $("#cupoMaximoUDGuias").attr('placeholder', value.cupo_max) 
        $("#cupoMaximoUDGuias").attr('readonly', false)
        
        $("#estadoUDGuias").val(value.estado)
        $("#estadoUDGuias").attr('placeholder', value.estado) 
        $("#estadoUDGuias").attr('readonly', false)

        $("#guiaUDGuias").val(value.guia)
        $("#guiaUDGuias").attr('placeholder', value.guia) 
        $("#guiaUDGuias").attr('readonly', false)
    }
    

    function cargarFormDeleteGuias(value)
    {
        $("#deleteDataGuias").show()
        $("#editDataGuias").hide()

        $("#idUDGuias").val(value.id_guia)
        $("#idUDGuias").attr('placeholder', value.id_guia) 
        
        $("#tipoUDGuias").val(value.tipo)
        $("#tipoUDGuias").attr('placeholder', value.tipo) 
        $("#tipoUDGuias").attr('readonly', true)
        
        $("#idiomaUDGuias").val(value.idioma)
        $("#idiomaUDGuias").attr('placeholder', value.idioma) 
        $("#idiomaUDGuias").attr('readonly', true)
        
        $("#costoUDGuias").val(value.costo)
        $("#costoUDGuias").attr('placeholder', value.costo) 
        $("#costoUDGuias").attr('readonly', true)

        $("#descripcionUDGuias").val(value.descripcion)
        $("#descripcionUDGuias").attr('placeholder', value.descripcion) 
        $("#descripcionUDGuias").attr('readonly', true)

        $("#fechaUDGuias").val(value.fecha)
        $("#fechaUDGuias").attr('placeholder', value.fecha) 
        $("#fechaUDGuias").attr('readonly', true)

        $("#horaUDGuias").val(value.hora)
        $("#horaUDGuias").attr('placeholder', value.hora) 
        $("#horaUDGuias").attr('readonly', true)
        
        $("#cantidadRegistradaUDGuias").val(value.cantidad_registrado)
        $("#cantidadRegistradaUDGuias").attr('placeholder', value.cantidad_registrado) 
        $("#cantidadRegistradaUDGuias").attr('readonly', true)
        
        $("#cupoMaximoUDGuias").val(value.cupo_max)
        $("#cupoMaximoUDGuias").attr('placeholder', value.cupo_max) 
        $("#cupoMaximoUDGuias").attr('readonly', true)
        
        $("#estadoUDGuias").val(value.estado)
        $("#estadoUDGuias").attr('placeholder', value.estado) 
        $("#estadoUDGuias").attr('readonly', true)
    }
    
    function cargarTablaGuias()
    {   
        $("#tablaGuias").empty()
            var id = $('#cargarTablaGuias').val()
            //console.log("if")
            $.ajax({
            url: "BackendGuias.php", //action
            type: "POST", //method
            //data: {"id_guia": id}, 
            //dataType: "json",
            success: function(respuesta){
                console.log(respuesta)
                var box = JSON.parse(respuesta) 
                console.log("datos cargados:",box)

                $.each(box, function(key, value){
                    //console.log("Respuesta: " + respuesta)
                    //console.log("Key: " , key)
                    //console.log("Value: " , value)

                    $("#tablaGuias").append("<tr class='estado"+value.estado+"' id='fila"+key+"'>"+
                    "<td class='xd xdwidth'>"+
                        "<div class='btn-group' role='group' aria-label='Basic example'>"+
                            "<button class='btn btn-sm btn-success text-center' id='edit"+key+"' data-bs-toggle='modal' data-bs-target='#modalUDGuias' >"+
                                "<img class='iconsize' src='../iconos/edit-3.svg'>"+
                            "</button>"+
                            "<button class='btn btn-sm btn-danger text-center' id='delete"+key+"' data-bs-toggle='modal' data-bs-target='#modalUDGuias' >"+
                                "<img class='iconsize' src='../iconos/trash-2.svg'>"+
                            "</button>"+
                            "<button class='btn btn-sm btn-secondary text-center' id='registros"+key+"' data-bs-toggle='modal' data-bs-target='#modalUDGuias' >"+
                                "<img class='iconsize' src='../iconos/users.svg'>"+
                            "</button>"+
                        "</div>"+
                            "<button class='btn btn-sm btn-warning text-center' id='refresh"+key+"''>"+
                            "<img class='iconsize' src='../iconos/refresh-ccw.svg'>"+
                        "</button>"+
                    "</td>"+
                    "<td class='xd'>"+value.id_guia+"</td>"+
                    "<td class='xd'>"+value.tipo+"</td>"+
                    "<td class='xd'>"+value.idioma+"</td>"+
                    "<td class='xd'>"+value.costo+"</td>"+
                    "<td class='xd'>"+value.descripcion+"</td>"+
                    "<td class='xd'>"+value.guia+"</td>"+
                    "<td class='xd'>"+value.fecha+"</td>"+
                    "<td class='xd'>"+value.hora+"</td>"+
                    "<td class='xd'>"+value.cantidad_registrado+"</td>"+
                    "<td class='xd'>"+value.cupo_max+"</td>"+
                    "<td class='xd'>"+value.estado+"</td>"+
                    "</tr>") 

                    $('#refresh'+key).attr('hidden', true)

                    if ($("#fechaActual").val() <= value.fecha && value.estado != 0) 
                    {
                        $('#refresh'+key).attr('hidden', false)
                    }
                    if ($("#fechaActual").val() > value.fecha && value.estado != 1) 
                    {
                        $('#refresh'+key).attr('hidden', false)
                    }

                    
                    $("#edit"+key).on("click", function(){
                        //console.log(value)
                        cargarFormEditGuias(value)
                    })

                    $("#delete"+key).on("click", function(){
                        //console.log(value)
                        cargarFormDeleteGuias(value)
                    })
                    
                    key = key + 1
                    
                    })
                }
            })
        //}
    }

    $("#cargarTablaGuias").click(function(){
        cargarTablaGuias();
    })

})

</script>
<style>
.xdwidth
{
    width: 200px;
}
.estado0
{
    background-color: lightblue;
}
.estado1
{
    background-color: lightcoral;
}
.xd
{
    text-align: center;
}

.iconsize
{
    height: auto;
    width: auto;
}
.action
{
    height: 40px;
    width: 40px;
}

.altura
{
    height: 40px;
}

/*oculta las flechas del input Type=number*/
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button 
{
    -webkit-appearance: none;
    margin: 0;
}

/*oculta las flechas del input Type=number en firefox*/
input[type=number] 
{
    -moz-appearance: textfield;
}

</style>
</body>
</html>