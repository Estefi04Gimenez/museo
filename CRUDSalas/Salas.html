<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../bootstrap-5.0.2/dist/css/bootstrap.css">
    <script src="../bootstrap-5.0.2/dist/js/bootstrap.js"></script>
    <script src="../bootstrap-5.0.2/jquery-3.6.0.js"></script>
    <title>Document</title>
</head>
<body>
    <body>
        <div class="container">
            <div class="row">
                <div class="col">
                      <h1>Consulta a base de datos</h1>      
                </div>
            </div>
            <div class="row justify-content-end">
                <div class="d-grid col-2">
                    <button id="botonModalSalas" type="button" class="btn text-center mb-2 btn-primary" data-bs-toggle="modal" data-bs-target="#myModalSalas">+</button>
                </div>   
            </div>
            <div class="row justify-content-between">
                <div class="d-grid col-4">
                    <button id="cargarTablaSalas" type="button" class="btn text-center mb-2 btn-primary">Cargar Tabla</button>
                </div>
                <div class="d-grid col-3">
                    <select class="form-control mb-2" name="selectMuseos" id="selectMuseos">
                        <option id='optiontMuseos' value='0'>--Seleccione un museo--</option>
                    </select>
                </div> 
                <div class="d-grid col-5">
                    <button id="ocultarTablaRelacionada" class="btn text-center mb-2 btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#tablaRelacionada" aria-expanded="false">Ocultar/Mostrar Tabla Relacionada</button>
                </div>       
            </div>
            <!-- The Modal --> 
            <div class="modal fade" data-bs-backdrop="static" id="myModalSalas">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                    
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">AÃ±adir datos</h4>
                            <button id="closeModalSalas(1)" type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                    
                        <!-- Modal body -->
                        <div class="container"> 
                            <form id="formAddSalas">
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Sala</label>
                                            <input name="sala" type="text" id="sala" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Piso</label>
                                            <input name="piso" type="text" id="piso" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Sector</label>
                                            <input name="sector" type="text" id="sector" min="0" max="150" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Punto inteligente</label>
                                            <input name="PuntoInteligente" type="text" id="PuntoInteligente" min="150" max="255" placeholder="" class="form-control">        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">                                        
                                            <label for="texto de ejemplo" class="form-label">Museo</label>
                                            <input name="idMuseo" type="text" id="museo" min="150" max="255" placeholder="" class="form-control" readonly>        
                                        </div>
                                    </div>
                                </div>
                            </form>    
                        </div>

                            <!-- Modal footer -->
                        <div class="modal-footer">
                            <button id="closeModalSalas2(1)" type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                            <button id="addDataSalas" type="button" class="btn btn-primary xd">enviar</button>
                        </div>        
                    </div>
                </div>      
            </div>   
            
            <div class="row">
                <div class="col-7">   
                    <table class="table table-bordered table-hover table-striped table-sm">
                        <thead>
                            <tr>
                                <th class='xd'>Acciones</th>
                                <th class='xd'>ID Sala</th>
                                <th class='xd'>sala</th>
                                <th class='xd'>piso</th>
                                <th class='xd'>Sector</th>
                                <th class='xd'>Punto inteligente</th>
                                <th class='xd'>Museo</th>
                            </tr>
                        </thead>
                        <tbody  id="tablaSalas">
                           
                        </tbody>
                    </table>    
                </div>
                <div class="collapse col-5" id="tablaRelacionada">   
                    <table class="table table-bordered table-hover table-striped table-sm">
                        <thead>
                            <tr>
                                <th class='xd'>Acciones</th>
                                <th class='xd'>ID Museo</th>
                                <th class='xd'>Nombre de Museo</th>
                            </tr>
                        </thead>
                        <tbody  id="tablaMuseos">
                           
                        </tbody>
                    </table>    
                </div>
                <!--<div class="col-2">-->
                    <!-- The Modal -->
                    <div class="modal fade" data-bs-backdrop="static" id="modalUDSalas">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <form id="formUDSalas">
                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <div class="col-5">
                                            <h4 class="modal-title">Editar datos</h4>
                                        </div>
                                        <div class="col-2">
                                            <label>id</label><input type="text" class="form-control" name="idUDSalas" id="idUDSalas" readonly>
                                        </div>
                                        <div class="col-5 text-end">  
                                            <button id="closeModalUDSalas" type="button" onclick="" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                    </div>
                            
                                    <!-- Modal body -->
                                    <div class="container"> 
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Sala</label>
                                                    <input name="salaUD" type="text" id="salaUD" min="0" max="150" placeholder="" class="form-control" readonly>        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Piso</label>
                                                    <input name="pisoUD" type="text" id="pisoUD" min="0" max="150" placeholder="" class="form-control" readonly>        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Sector</label>
                                                    <input name="sectorUD" type="text" id="sectorUD" min="0" max="150" placeholder="" class="form-control" readonly>        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Punto inteligente</label>
                                                    <input name="PuntoInteligenteUD" type="text" id="PuntoInteligenteUD" min="0" max="150" placeholder="" class="form-control" readonly>        
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">                                        
                                                    <label for="texto de ejemplo" class="form-label">Museo</label>
                                                    <input name="idMuseoUD" type="text" id="idMuseoUD" min="0" max="11" placeholder="" class="form-control" readonly>        
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>  
                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button id="closeModalUDSalas2" type="button" class="btn btn-danger"  data-bs-dismiss="modal">Cancelar</button>
                                    <button id="editDataSalas" type="button" class="btn btn-primary xd" >enviar</button>
                                    <button id="deleteDataSalas" type="button" class="btn btn-danger xd" >eliminar</button>
                                </div>        
                            </div>
                        </div>  
                    </div>
                <!--</div>-->
            </div>
        </div>
    </body>
    </html>
    
<script>

$(document).ready(function()
{
    function cargarMuseosSalas ()
    { 
    $.ajax({
        type:"POST",    
        url:"BackendSalas.php",
        data: {"funcion": 1},
        success:function(respuesta){
            
            console.log(respuesta)
            var box = JSON.parse(respuesta) 
            console.log("datos cargados:",box)

            
            $.each(box, function(key, value){ 
                $('#selectMuseos').append("<option id='optiontMuseos' value='"+value.id_museo+"'>"+value.nombre+"</option>")
                
            })
        }
     })
    }
    cargarMuseosSalas();

    $('#botonModalSalas').click(function(){
        $('#addDataSalas').attr('disabled', false)
        console.log($('#selectMuseos').val())
        var x = $('#selectMuseos').val()
        $('#museo').val(x)

        if(x == 0)
        {
            $('#addDataSalas').attr('disabled', true)
            alert('Seleccione un Museo')
        }

    })

    async function confirmAddSalas()
    {
    var datos = $('#formAddSalas').serializeArray();
    console.log("xd: ",datos)
    $.ajax({
        type:"POST",    
        url:"addSalas.php",
        data: datos,
        success:function(r){
            if(r == 1)
            {
                alert("agregado con exito");
                //$("#ordenarNomb").val(salaMuseo.value)
                cargarTablaSalas();
                $("#myModalSalas").modal('hide')
            }else
            {
                alert("Fallo");
            }
        }
    })
    }
    $("#addDataSalas").on("click", function(){confirmAddSalas() }) 

    function confirmEditSalas()
    {
        var editarDatos = $("#formUDSalas").serializeArray();

        $.ajax({
        url: "RenameSalas.php",
        type: "POST",
        data: editarDatos,
        success: function(r)
        {
            if (r == 1) 
                {

                alert("datos modificados con exito")
               // $("#ordenarNomb").val(salaUD.value)
                cargarTablaSalas()
                $("#modalUDSalas").modal('hide')

                }
            }
        })
        
    }

    function confirmDeleteSalas()
    {
        var eliminarDatos = $("#formUDSalas").serializeArray();
        //console.log("editarDatos: ", eliminarDatos)
        $.ajax({
        url: "DeleteSalas.php",
        type: "POST",
        data: eliminarDatos,
        success: function(r){
            if (r == 1) 
                {
                
                alert("datos Eliminados")
                cargarTablaSalas()
                $("#modalUDSalas").modal('hide')
                
                }
            }
        })
    }

    $("#editDataSalas").on("click", function(){confirmEditSalas() }) 
    $("#deleteDataSalas").on("click", function(){confirmDeleteSalas()}) 

    function cargarFormEditSalas(value)
    {
        $("#editDataSalas").show()
        $("#deleteDataSalas").hide()
        
        $("#idUDSalas").val(value.id_sala)
        $("#idUDSalas").attr('placeholder', value.id_sala) 
        
        $("#salaUD").val(value.sala)
        $("#salaUD").attr('placeholder', value.sala) 
        $("#salaUD").attr('readonly', false)
        
        $("#pisoUD").val(value.piso)
        $("#pisoUD").attr('placeholder', value.piso) 
        $("#pisoUD").attr('readonly', false)
        
        $("#sectorUD").val(value.sector)
        $("#sectorUD").attr('placeholder', value.sector) 
        $("#sectorUD").attr('readonly', false)

        $("#PuntoInteligenteUD").val(value.punto_inteligente)
        $("#PuntoInteligenteUD").attr('placeholder', value.punto_inteligente) 
        $("#PuntoInteligenteUD").attr('readonly', false)

        $("#idMuseoUD").val(value.id_museo)
        $("#idMuseoUD").attr('placeholder', value.id_museo) 
        $("#idMuseoUD").attr('readonly', true)
    }

    function cargarFormDeleteSalas(value)
    {
        $("#deleteDataSalas").show()
        $("#editDataSalas").hide()

        $("#idUDSalas").val(value.id_sala)
        $("#idUDSalas").attr('placeholder', value.id_sala) 
        
        $("#salaUD").val(value.sala)
        $("#salaUD").attr('placeholder', value.sala) 
        $("#salaUD").attr('readonly', true)
        
        $("#pisoUD").val(value.piso)
        $("#pisoUD").attr('placeholder', value.piso) 
        $("#pisoUD").attr('readonly', true)
        
        $("#sectorUD").val(value.sector)
        $("#sectorUD").attr('placeholder', value.sector) 
        $("#sectorUD").attr('readonly', true)

        $("#PuntoInteligenteUD").val(value.punto_inteligente)
        $("#PuntoInteligenteUD").attr('placeholder', value.punto_inteligente) 
        $("#PuntoInteligenteUD").attr('readonly', true)

        $("#idMuseoUD").val(value.id_museo)
        $("#idMuseoUD").attr('placeholder', value.id_museo) 
        $("#idMuseoUD").attr('readonly', true)
    }
    
    function cargarTablaSalas()
    {   
    $("#tablaSalas").empty()
    $("#tablaMuseos").empty()    

        var idMuseo = $('#selectMuseos').val()
        $.ajax({
        url: "BackendSalas.php", 
        type: "POST",
        data: {"id_museo": idMuseo,"funcion":6}, 
        //dataType: "json",
        success: function(respuesta){
            console.log(respuesta)
            var box = JSON.parse(respuesta) 
            console.log("datos cargados:",box)

            $.each(box, function(key, value){
                //console.log("Respuesta: " + respuesta)
                //console.log("Key: " , key)
                //console.log("Value: " , value)

                $("#tablaSalas").append("<tr id='fila"+key+"'>"+
                "<td class='xd'>"+
                    "<div class='btn-group' role='group' aria-label='Basic example'>"+
                        "<button class='btn btn-sm btn-success text-center' id='edit"+key+"' data-bs-toggle='modal' data-bs-target='#modalUDSalas' >"+
                            "<img class='iconsize' src='../iconos/edit-3.svg'>"+
                        "</button>"+
                        "<button class='btn btn-sm btn-danger text-center' id='delete"+key+"' data-bs-toggle='modal' data-bs-target='#modalUDSalas' >"+
                            "<img class='iconsize' src='../iconos/trash-2.svg'>"+
                        "</button>"+
                    "</div>"+
                "</td>"+
                "<td class='xd'>"+value.id_sala+"</td>"+
                "<td class='xd'>"+value.sala+"</td>"+
                "<td class='xd'>"+value.piso+"</td>"+
                "<td class='xd'>"+value.sector+"</td>"+
                "<td class='xd'>"+value.punto_inteligente+"</td>"+
                "<td class='xd'>"+value.id_museo+"</td>"+
                "</tr>") 

                $("#tablaMuseos").append("<tr class='altura2' id='fila"+key+"'>"+
                    "<td class='xd'>"+value.nombre+"</td>"+
                    "<td class='xd'>"+value.ubicacion+"</td>"+
                    "<td class='xd'>"+value.tipo_museo+"</td>"+
                "</tr>") 

                $("#edit"+key).on("click", function(){
                    //console.log(value)
                    cargarFormEditSalas(value)
                })

                $("#delete"+key).on("click", function(){
                    //console.log(value)
                    cargarFormDeleteSalas(value)
                })
                
                key = key + 1
                
                })
            }
        })

    }

    $("#cargarTablaSalas").click(function(){
        cargarTablaSalas();
    })

})

</script>
<style>
.sex
{
    border: solid, red;
}

.xd
{
    text-align: center;
}

.iconsize
{
    height: auto;
    width: auto;
}
.action
{
    height: 40px;
    width: 40px;
}

.altura
{
    height: 40px;
}
.altura2
{
    height: 44px;
}
/*oculta las flechas del input Type=number*/
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button 
{
    -webkit-appearance: none;
    margin: 0;
}

/*oculta las flechas del input Type=number en firefox*/
input[type=number] 
{
    -moz-appearance: textfield;
}

</style>
</body>
</html>